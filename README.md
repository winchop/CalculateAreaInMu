<img src="icon400x400.svg" width="100" />

---
# 计算面积（亩）插件  
**Calculate Area in Mu – QGIS Plugin**

A simple QGIS plugin to calculate polygon areas and store the result in **Chinese mu (亩)** — a traditional unit of area commonly used in China (1 亩 ≈ 666.67 m²). The plugin automatically adds a field named `Mu` and fills it with area values converted from square meters.

一个轻量级 QGIS 插件，用于计算面要素的面积，并将结果以中国常用的土地面积单位 **“亩”** 存储。插件会自动添加名为 `Mu` 的字段，并填入由平方米换算而来的亩数（1 平方米 = 0.0015 亩）。

---

## 🌟 功能特点 / Features

- **一键计算**：选中面图层后，点击工具即可批量计算所有要素的面积（亩）  
- **自动建字段**：若图层中不存在 `Mu` 字段，插件会自动创建（类型为双精度浮点数）  
- **智能处理无效几何**：跳过空或无效几何，并将其 `Mu` 值设为 `NULL`  
- **支持撤销**：整个计算过程封装在 QGIS 撤销栈中，可一键撤销  
- **纯 PyQGIS 实现**：无外部依赖，兼容 QGIS 3.16+  

---

## 📥 安装方法 / Installation

### 方法一：手动安装（推荐）
1. 下载插件文件 [`calculate_area_in_mu.py`](https://github.com/yourname/calculate_area_in_mu/releases)（以及可选的 `icon.svg` 图标）  
2. 将文件放入 QGIS 插件目录：
   - **Windows**:  
     `%APPDATA%\QGIS\QGIS3\profiles\default\python\plugins\calculate_area_in_mu\`
   - **macOS**:  
     `~/Library/Application Support/QGIS/QGIS3/profiles/default/python/plugins/calculate_area_in_mu/`
   - **Linux**:  
     `~/.local/share/QGIS/QGIS3/profiles/default/python/plugins/calculate_area_in_mu/`
3. 重启 QGIS，在菜单栏 **插件 → 管理和安装插件** 中启用 “计算面积（亩）”

> 💡 注意：请确保文件夹名为 `calculate_area_in_mu`，且包含 `__init__.py`（可为空）以被 QGIS 识别为插件。

### 方法二：直接放置脚本（简易模式）
如果你仅需临时使用，也可通过 **Python 控制台** 直接运行 `.py` 脚本，但无法获得工具栏按钮和撤销支持。

---

## 🛠️ 使用说明 / Usage

1. 加载一个 **面矢量图层**（如 Shapefile、GeoPackage 等）  
2. 在图层面板中 **选中该图层**  
3. 点击菜单或工具栏中的 **“计算面积（亩）…”** 按钮  
4. 插件将自动：
   - 检查图层是否为多边形类型
   - 添加 `Mu` 字段（如不存在）
   - 计算每个有效要素的面积并写入亩值
5. 完成后，状态栏会显示成功更新的要素数量及无效几何数量

> ✅ 提示：1 平方米 = 0.0015 亩（即 1 亩 = 666.666... 平方米）

---

## 🧪 环境要求 / Requirements

- QGIS 3.16 或更高版本  
- Python 3（QGIS 自带）  
- 可编辑的 **Polygon 类型矢量图层**

---

## 📜 许可证 / License

本项目采用 **MIT 许可证** 发布。  
详见 [LICENSE](LICENSE) 文件（如有）。

---

## 🙌 贡献与反馈 / Contributing & Feedback

欢迎提交 Issue 或 Pull Request！  
如需新增功能（如自定义字段名、支持其他单位等），请留言建议。

📧 **联系作者**：🚁Chopper🚁
winchop@gmail.com  
GitHub: [@winchop](https://github.com/winchop)

---
“亩”是中国传统土地面积单位，具有悠久的历史，其起源可追溯至先秦时期，并在不同朝代经历了多次演变。以下是关于“亩”这一单位的历史溯源与演变过程：

---

### 一、起源：井田制与“步”“亩”的诞生（西周–春秋战国）

- **井田制背景**：  
  西周时期实行“井田制”，将土地划分为“九宫格”状的方块田，中间为公田，周围八块为私田。这种制度催生了早期的土地计量需求。

- **“步”为基本单位**：  
  古人以“步”作为长度单位（一步 = 左右脚各迈一次，约相当于今1.5米左右，但历代有差异）。  
  面积则以“平方步”计算。

- **“亩”的定义初现**：  
  战国时期，《周礼》《孟子》等文献记载：“**方百步为亩**”，即一块边长为100步的正方形土地为1亩。  
  按此计算：1亩 = 100 × 100 = 10,000 平方步。

> 📌 注意：此时“亩”是**面积单位**，但“步”的实际长度因地域和时代而异，故亩的实际大小并不统一。

---

### 二、秦汉统一：标准化尝试

- **秦朝“车同轨，书同文，度同制”**：  
  秦始皇统一度量衡，规定 **240 步为一亩**（不再是“方百步”），这是中国历史上首次对“亩”进行官方标准化。

- **汉承秦制**：  
  汉代沿用“**广一步，长二百四十步为亩**”（即宽1步、长240步的长条形地块），面积仍为 240 平方步。  
  这种“狭长型”亩更便于耕作和沟渠布置，成为后世主流。

> ✅ 关键转变：从“方百步”（10,000 平方步）变为“240 平方步”，**亩的实际面积大幅缩小**，更贴近实际农耕需求。

---

### 三、唐宋至明清：步尺变化，亩积浮动

- 历代“步”和“尺”的长度不断变化：
  - 唐代：1步 ≈ 5尺，1尺 ≈ 0.295 米 → 1亩 ≈ 5 × 0.295 × 240 ≈ **418 平方米**
  - 宋代：尺略长，亩约 **600 平方米**
  - 明清：1营造尺 ≈ 0.32 米，1步 = 5尺 → 1亩 = 240 × (0.32×0.32) ≈ **614.4 平方米**

> 🔁 尽管“240步为亩”的制度未变，但因“尺”的标准变化，**亩的实际面积在500–800平方米之间浮动**。

---

### 四、近代标准化：1亩 = 60平方丈 = 666.67平方米

- **1930年国民政府《度量衡法》**：  
  正式规定采用“市制”单位，明确：
  - 1丈 = 10尺
  - 1尺 = 1/3 米（≈0.3333米）
  - 1亩 = 60平方丈 = 60 × (10/3)² = **2000/3 ≈ 666.666... 平方米**

- **中华人民共和国沿用**：  
  新中国成立后虽推行公制，但考虑到农业习惯，**保留“亩”作为辅助单位**，并明确定义：
  > **1 亩 = 666.666... 平方米 ≈ 666.67 m²**  
  > **1 平方米 = 0.0015 亩**

---

### 五、文化意义

- “亩”不仅是一个计量单位，更是中国传统农耕文明的象征。
- 成语如“**一亩三分地**”（原指皇帝耤田面积，后引申为个人势力范围）、“**广种薄收**”等均与“亩”相关。
- 至今在中国农村、土地管理、农业政策中，“亩”仍是常用单位。

---

### 时间线

| 时期       | 亩的定义                     | 约合现代面积 |
|------------|------------------------------|---------------|
| 先秦       | 方百步为亩                   | ≈ 10,000 平方步（面积大，不统一）|
| 秦汉       | 广1步 × 长240步              | ≈ 240 平方步（标准化起点）|
| 唐宋明清   | 仍为240步，但步长变化        | 500–800 m² 不等 |
| 1930年至今 | 1亩 = 60平方丈 = 2000/3 m²   | **666.67 m²**（法定标准）|

---